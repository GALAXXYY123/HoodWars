<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Menu</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
</head>
<body>
  <!-- Меню -->
  <div class="menu-wrapper" id="menu-wrapper">
    <div class="menugrid">
      <button class="charcard"><div class="charcardname">G. SAM</div></button>
      <button class="charcard"><div class="charcardname">ДЯДЯ ЖЕНЯ</div></button>
      <button class="charcard"><div class="charcardname">ГРИША ГОФМАН</div></button>
      <button class="charcard"><div class="charcardname">POLYANA</div></button>
    </div>
    <a href="#" class="btn" id="gameBtn">GAME</a>
  </div>

  <!-- HUD загрузки -->
  <div id="loading-hud" aria-hidden="true">
    <div class="loading-box" role="status" aria-live="polite" aria-label="Загрузка">
      <h2 class="loading-title">ДВИГАЕМ НА РАЙОН…</h2>
      <div class="progress">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
      <div class="percent" id="loading-percent">0%</div>
    </div>
  </div>

  <script>
    const cards = document.querySelectorAll(".charcard");
    const gameBtn = document.getElementById("gameBtn");
    const menuWrapper = document.getElementById("menu-wrapper");
    const hud = document.getElementById("loading-hud");
    const percentEl = document.getElementById("loading-percent");
    const barEl = document.getElementById("progress-bar");
    const DURATION_MS = 1000;

    let isLoading = false;

    cards.forEach(card => {
      card.addEventListener("click", () => {
        cards.forEach(c => c.classList.remove("active"));
        card.classList.add("active");
        gameBtn.classList.add("active");
      });
    });

    function startProgress(ms) {
      const start = performance.now();
      const tick = (now) => {
        const ratio = Math.min(1, (now - start) / ms);
        const pct = Math.floor(ratio * 100);
        percentEl.textContent = pct + "%";
        barEl.style.width = pct + "%";
        if (ratio < 1) requestAnimationFrame(tick);
        else {
          percentEl.textContent = "100%";
          barEl.style.width = "100%";
          setTimeout(() => window.location.href = "game.html", 300);
        }
      };
      requestAnimationFrame(tick);
    }

    gameBtn.addEventListener("click", (e) => {
      e.preventDefault();
      if (!gameBtn.classList.contains("active") || isLoading) return;
      isLoading = true;
      menuWrapper.style.display = "none";
      hud.classList.add("visible");
      hud.setAttribute("aria-hidden", "false");
      startProgress(DURATION_MS);
    });
  </script>
</body>
</html>
